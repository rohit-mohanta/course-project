pipeline {
    agent {label "local"}
    stages {
        stage('git') {
            steps {
		script {
	 		sh '''#!/bin/bash
				ssh -o "StrictHostKeyChecking no" app-host << ENDSSH
				git clone https://github.com/rohit-mohanta/course-project.git
			    ls -ltrh
ENDSSH
'''
                }
            }
        }
        
        stage('docker') {
            steps {
		script {
	 		sh '''#!/bin/bash
				ssh -o "StrictHostKeyChecking no" app-host << ENDSSH
				cd course-project/test-nodeapp-1-task/
				sudo docker build -f dockerfile -t node-app .
				sudo docker tag node-app:latest public.ecr.aws/e3u3y5v0/course-project:latest
			    sudo docker push public.ecr.aws/e3u3y5v0/course-project:latest
ENDSSH
'''
                }
            }
        }
    }
}